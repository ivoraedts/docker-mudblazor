@page "/addcalendarevent"
@using MyApplication.Client.Models
@inject NavigationManager NavigationManager


<h3>Add Calendar Event</h3>

<MudTextField @bind-value="newTitle" Label="Title" Variant="Variant.Outlined" />
<MudTextField @bind-value="newDescription" Label="Description" Variant="Variant.Outlined" Lines="3" />

<MudButton Color="Color.Primary" Variant="Variant.Filled" @onclick="AddItem">Add Item</MudButton>

<MudText Class="mb-4">Id of last item: @idOfLastItem</MudText>

@inject HttpClient Http
@code {
    private int idOfLastItem = 0;
    private string newTitle = string.Empty;
    private string newDescription = string.Empty;


    protected override async Task OnInitializedAsync()
    {
        // Initialization logic if needed
    }

    private async Task AddItem()
    {
        var apiUrl = NavigationManager.BaseUri + "api/calendarevent";

        var newEvent = new CalendarEvent
        {
            Title = newTitle != null ? newTitle : "New Title",
            Description = newDescription != null ? newDescription : $"Something interesting added at {DateTime.Now}"
        };

        var response = await Http.PostAsJsonAsync(apiUrl, newEvent);
    
        if (response.IsSuccessStatusCode)
        {
            var addedEvent = await response.Content.ReadFromJsonAsync<CalendarEvent>();
            if (addedEvent != null) idOfLastItem = addedEvent.Id;
        }

        NavigationManager.NavigateTo($"/calendarevent/{idOfLastItem}");
    }
}